<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Recambios - Control de inventario</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="header-main">
        <h1>Stock Recambios</h1>
        <p class="subtitle">Azkoyen 路 Jofemar 路 No Asignado</p>
      </div>
      <div class="theme-toggle" aria-label="Cambiar tema">
        <button id="btn-theme-light" type="button" title="Modo claro"></button>
        <button id="btn-theme-dark" type="button" title="Modo oscuro"></button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-view="listado">Listado</button>
      <button class="tab" data-view="nuevo">Nuevo recambio</button>
      <button class="tab" data-view="importar">Importar</button>
      <button class="tab" data-view="campos">Campos adicionales</button>
    </nav>

    <main class="content">
      <!-- Vista: Listado -->
      <section id="view-listado" class="view active">
        <div class="filters">
          <div class="filters-group">
            <select id="filter-fabricante">
              <option value="">Todos los fabricantes</option>
              <option value="Azkoyen">Azkoyen</option>
              <option value="Jofemar">Jofemar</option>
              <option value="No Asignado">No Asignado</option>
            </select>
            <select id="filter-sort" title="Ordenar por">
            <option value="codigo_interno-asc">C贸digo (A-Z)</option>
            <option value="codigo_interno-desc">C贸digo (Z-A)</option>
            <option value="alias-asc">Alias (A-Z)</option>
            <option value="alias-desc">Alias (Z-A)</option>
            <option value="nombre_tecnico-asc">Nombre t茅cnico (A-Z)</option>
            <option value="nombre_tecnico-desc">Nombre t茅cnico (Z-A)</option>
            <option value="fabricante-asc">Fabricante (A-Z)</option>
            <option value="fabricante-desc">Fabricante (Z-A)</option>
            <option value="cantidad-asc">Stock (menor a mayor)</option>
            <option value="cantidad-desc">Stock (mayor a menor)</option>
            <option value="updated_at-desc">M谩s recientes</option>
            <option value="updated_at-asc">M谩s antiguos</option>
          </select>
          </div>
          <input type="search" id="filter-search" placeholder="Buscar en tiempo real por c贸digo, nombre, alias, observaciones...">
          <button id="btn-buscar">Buscar</button>
          <button type="button" id="btn-eliminar-seleccionados" class="btn btn-danger btn-sm hidden" title="Eliminar seleccionados">Eliminar seleccionados</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th class="col-checkbox">
                  <input type="checkbox" id="select-all-recambios" title="Seleccionar todos" aria-label="Seleccionar todos">
                </th>
                <th>Fabricante</th>
                <th>C贸digo interno</th>
                <th>Nombre t茅cnico</th>
                <th>Alias</th>
                <th class="col-cantidad">Stock</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="table-body">
              <tr><td colspan="7" class="loading">Cargando...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Vista: Nuevo recambio -->
      <section id="view-nuevo" class="view">
        <form id="form-nuevo" class="form-recambio">
          <div class="form-grid">
            <div class="field">
              <label for="nuevo-fabricante">Fabricante *</label>
              <select id="nuevo-fabricante" required>
                <option value="">Seleccionar...</option>
                <option value="Azkoyen">Azkoyen</option>
                <option value="Jofemar">Jofemar</option>
              </select>
            </div>
            <div class="field">
              <label for="nuevo-codigo-interno">C贸digo interno *</label>
              <input type="text" id="nuevo-codigo-interno" required placeholder="Ej: AZC-001">
            </div>
            <div class="field">
              <label for="nuevo-codigo-fabricante">C贸digo fabricante</label>
              <input type="text" id="nuevo-codigo-fabricante" placeholder="C贸digo del fabricante">
            </div>
            <div class="field">
              <label for="nuevo-nombre-tecnico">Nombre t茅cnico</label>
              <input type="text" id="nuevo-nombre-tecnico" placeholder="Nombre t茅cnico del recambio">
            </div>
            <div class="field">
              <label for="nuevo-alias">Alias</label>
              <input type="text" id="nuevo-alias" placeholder="Nombre coloquial">
            </div>
            <div class="field">
              <label for="nuevo-cantidad">Cantidad *</label>
              <input type="number" id="nuevo-cantidad" min="0" value="0" required>
            </div>
          </div>
          <div class="field">
            <label for="nuevo-observaciones">Observaciones</label>
            <textarea id="nuevo-observaciones" rows="3" placeholder="Notas adicionales..."></textarea>
          </div>
          <div id="nuevo-custom-fields" class="custom-fields-section"></div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar recambio</button>
            <button type="reset" class="btn btn-secondary">Limpiar</button>
          </div>
        </form>
      </section>

      <!-- Vista: Importar -->
      <section id="view-importar" class="view">
        <div class="form-recambio import-section">
          <p class="import-desc">Sube un archivo CSV o Excel (.xlsx) con los recambios. Luego asigna cada columna del archivo al campo correspondiente.</p>
          <div class="import-upload">
            <input type="file" id="import-file" accept=".csv,.xlsx,.xls" hidden>
            <button type="button" id="btn-select-file" class="btn btn-secondary">Seleccionar archivo CSV o Excel</button>
            <span id="import-filename" class="import-filename"></span>
          </div>
          <div id="import-mapping" class="import-mapping hidden">
            <h4>Asignar columnas</h4>
            <p class="import-mapping-hint">Indica qu茅 columna del archivo corresponde a cada campo. Selecciona al menos un campo. Deja en blanco para no importar esa columna.</p>
            <div id="import-mapping-fields" class="import-mapping-fields"></div>
            <div class="import-preview-section">
              <h4>Vista previa (primeras 5 filas)</h4>
              <div class="table-container import-preview-table">
                <table class="data-table" id="import-preview-table">
                  <thead id="import-preview-thead"></thead>
                  <tbody id="import-preview-tbody"></tbody>
                </table>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" id="btn-importar" class="btn btn-primary">Importar recambios</button>
              <button type="button" id="btn-import-reset" class="btn btn-secondary">Cambiar archivo</button>
            </div>
          </div>
          <div id="import-result" class="import-result hidden"></div>
        </div>
      </section>

      <!-- Vista: Campos adicionales (editar nombres) -->
      <section id="view-campos" class="view">
        <div class="form-recambio">
          <p class="campos-desc">Define los nombres de los campos extra que aparecer谩n al crear o editar recambios. El valor lo asigna el usuario en cada recambio.</p>
          <div id="campos-lista" class="campos-lista"></div>
          <div class="campos-nuevo">
            <input type="text" id="nuevo-campo-nombre" placeholder="Nombre del nuevo campo (ej: Ubicaci贸n, Proveedor)">
            <button type="button" id="btn-add-campo" class="btn btn-primary">A帽adir campo</button>
          </div>
        </div>
      </section>

      <!-- Vista: Detalle recambio (panel deslizante) -->
      <section id="view-detalle" class="view view-panel">
        <div class="panel-header">
          <h2>Detalle del recambio</h2>
          <button id="btn-cerrar-detalle" class="btn-close"></button>
        </div>
        <div id="detalle-content" class="detalle-content"></div>
        <div class="form-actions detalle-actions">
          <div class="detalle-actions-left">
            <button type="button" id="btn-editar-desde-detalle" class="btn btn-primary">Editar</button>
            <button type="button" id="btn-cerrar-detalle-abajo" class="btn btn-secondary">Cerrar</button>
          </div>
          <button type="button" id="btn-eliminar-desde-detalle" class="btn btn-danger btn-trash" title="Eliminar" aria-label="Eliminar">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
          </button>
        </div>
      </section>

      <!-- Vista: Editar recambio (modal/panel) -->
      <section id="view-editar" class="view view-panel">
        <div class="panel-header">
          <h2>Editar recambio</h2>
          <button id="btn-cerrar-editar" class="btn-close"></button>
        </div>
        <form id="form-editar" class="form-recambio">
          <input type="hidden" id="editar-id">
          <div class="form-grid">
            <div class="field">
              <label for="editar-fabricante">Fabricante *</label>
              <select id="editar-fabricante" required>
                <option value="Azkoyen">Azkoyen</option>
                <option value="Jofemar">Jofemar</option>
                <option value="No Asignado">No Asignado</option>
              </select>
            </div>
            <div class="field">
              <label for="editar-codigo-interno">C贸digo interno *</label>
              <input type="text" id="editar-codigo-interno" required>
            </div>
            <div class="field">
              <label for="editar-codigo-fabricante">C贸digo fabricante</label>
              <input type="text" id="editar-codigo-fabricante">
            </div>
            <div class="field">
              <label for="editar-nombre-tecnico">Nombre t茅cnico</label>
              <input type="text" id="editar-nombre-tecnico">
            </div>
            <div class="field">
              <label for="editar-alias">Alias</label>
              <input type="text" id="editar-alias">
            </div>
            <div class="field field-stock">
              <label for="editar-cantidad">Stock *</label>
              <input type="number" id="editar-cantidad" min="0" required>
              <span id="stock-bajo-badge" class="badge badge-warning hidden">Stock bajo</span>
            </div>
          </div>
          <div class="field">
            <label for="editar-observaciones">Observaciones</label>
            <textarea id="editar-observaciones" rows="3"></textarea>
          </div>
          <div id="editar-custom-fields" class="custom-fields-section"></div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar cambios</button>
            <button type="button" id="btn-cancelar-editar" class="btn btn-secondary">Cancelar</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
